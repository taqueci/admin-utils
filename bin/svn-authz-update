#!/bin/sh

# Example:
#   svn-authz-update XXXXXX \ 
#     -r project-x -r project-y \ 
#     @XXXXXX-administrators:/=r,/trunk=rw,/branches=rw,/tags=rw \ 
#     @XXXXXX-developers:/=r,/trunk=rw,/branches=rw,/tags=r \ 
#     @XXXXXX-users:/=r,/trunk=r,/branches=r,/tags=r

topdir=$(cd $(dirname $0)/.. && pwd)

. $topdir/config/admin.cfg || exit 1

if [ -z "$1" ]; then
	echo "*** ERROR ***: Too few arguments"
	exit 1
fi

key=$1
shift

test -d $SVN_AUTHZ_DIR || mkdir -p $SVN_AUTHZ_DIR || exit 1

perl -I$topdir/lib/perl $topdir/script/svn-authz-tmpl.pl \
	-o $SVN_AUTHZ_DIR/$key.authz "$@" || exit 1

perl -I$topdir/lib/perl $topdir/script/svn-authz-merge.pl \
	-o $SVN_AUTHZ_TMPL $SVN_AUTHZ_DIR/*.authz || exit 1

$topdir/bin/svn-authz-crowd || exit 1
